<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.2/css/bulma.min.css">
    <link rel="stylesheet" href="https://cdn.materialdesignicons.com/4.9.95/css/materialdesignicons.min.css">
    <link href="/views/images/original-logo.jpg" rel="icon" type="image/png">
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/img/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicon-16x16.png">
    <link rel="manifest" href="/assets/img/site.webmanifest">
</head>
<body>
<div class="section is-small is-fullheight">
    <div class="container has-text-centered">
        <div class="columns is-centered">
            <div class="column is-three-quarters">
                <div class="is-spaced">
                    <figure class="image is-64x64" style="margin: 0 auto; border: 2px solid dodgerblue; border-radius: 50%">
                        <img class="is-rounded" src="/assets/img/logo.png">
                    </figure>
                    <h1 class="has-text-left has-text-weight-bold is-size-5 pt-4 pb-4">{{ pageName }}</h1>
                    <form id="occupational-form" method="post">
                        <div class="columns is-multiline">
                            <div class="column is-12">
                                <div class="field has-text-left">
                                    <label class="">Work Status</label>
                                    <div class="select is-info is-normal is-fullwidth">
                                        <select name="work-status" required>
                                            {% set roles = ['Employed', 'Self-Employed', 'Unemployed'] %}
                                            {% for role in roles %}
                                                <option value="{{ role }}">{{ role }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="column is-6">
                                <div class="field is-6 has-text-left">
                                    <label class="">Position</label>
                                    <input type="text" name="position" class="input is-normal is-info" placeholder="Enter position" required>
                                </div>
                            </div>

                            <div class="column is-6">
                                <div class="field is-6 has-text-left">
                                    <label class="">Department</label>
                                    <input type="text" name="department" class="input is-normal is-info" placeholder="Enter department" required>
                                </div>
                            </div>

                            <div class="column is-6">
                                <div class="field is-6 has-text-left">
                                    <label class="">Company Name</label>
                                    <input type="text" name="company-name" class="input is-normal is-info" placeholder="Enter company name" required>
                                </div>
                            </div>

                            <div class="column is-6">
                                <div class="field is-6 has-text-left">
                                    <label class="">Company Address</label>
                                    <input type="text" name="company-address" class="input is-normal is-info" placeholder="Enter company address" required>
                                </div>
                            </div>

                            <div class="column is-2">
                                <div class="field mt-5">
                                    <div class="control">
                                        <button type="submit" name="next" class="button is-normal is-info is-focused is-fullwidth" onclick="showLoadingOverlay(event)">
                                            <span>Next</span>
                                            <span class="mdi mdi-chevron-right is-size-3"></span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="column is-2">
                                <div class="field mt-5">
                                    <div class="control">
                                        <a href="javascript:history.back()" class="button is-link is-light">
                                            <span class="icon"><i class="mdi mdi-arrow-left"></i></span>
                                            <span>Back</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    <p class="mt-6">
                        Already have an account? <a href="/">Sign In</a>
                    </p>
                    <hr>
                    <p class="mt-5">All rights reserved, Copyright &copy; {{ "now"|date("Y") }} . Chalom Investments Limited</p>
                    <p><strong>Powered By:</strong> <a href="https://www.fortresshubtechnologies.com" target="_blank">Fortress Hub Technologies</a></p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    // function showLoadingOverlay(event) {
    //     event.preventDefault();
    //
    //     const form = document.getElementById('occupational-form');
    //     const button = event.target.closest('button');
    //     const originalBtnHTML = button.innerHTML;
    //
    //     button.disabled = true;
    //     button.innerHTML = `<span class="loader"></span> Saving...`;
    //
    //     const formData = new FormData(form);
    //
    //     fetch(form.action, {
    //         method: 'POST',
    //         body: formData,
    //         redirect: 'follow' // Automatically follow 302 redirect
    //     })
    //         .then(response => {
    //             // If the server responds with a redirect, browser automatically follows
    //             // So if we're here, we're on the next page
    //             if (response.redirected) {
    //                 window.location.href = response.url;
    //             } else {
    //                 return response.text().then(html => {
    //                     // fallback: show any returned HTML (e.g., error page)
    //                     document.body.innerHTML = html;
    //                 });
    //             }
    //         })
    //         .catch(error => {
    //             console.error(error);
    //             alert("Something went wrong.");
    //             button.disabled = false;
    //             button.innerHTML = originalBtnHTML;
    //         });
    // }
</script>
<script>
    function showLoadingOverlay(event) {
        event.preventDefault();

        const form = document.getElementById('occupational-form');
        const button = event.target.closest('button');
        const originalBtnHTML = button.innerHTML;
        const inputs = form.querySelectorAll('input[required], select[required]');

        let hasError = false;

        // Validate all required inputs
        inputs.forEach((input) => {
            input.classList.remove('invalid');
            input.style.borderColor = '';

            if (!input.value.trim()) {
                if (!hasError) {
                    input.focus(); // focus first invalid input
                }

                input.classList.add('invalid');
                input.style.borderColor = 'red';
                hasError = true;
            } else {
                input.classList.remove('invalid');
                input.style.borderColor = 'green';
            }
        });

        if (hasError) {
            return; // Stop submission if any required field is empty
        }

        // All fields valid, show loading and submit
        button.disabled = true;
        button.innerHTML = `<span class="loader"></span> Saving...`;

        const formData = new FormData(form);

        fetch(form.action, {
            method: 'POST',
            body: formData,
            redirect: 'follow'
        })
            .then(response => {
                if (response.redirected) {
                    window.location.href = response.url;
                } else {
                    return response.text().then(html => {
                        document.body.innerHTML = html;
                    });
                }
            })
            .catch(error => {
                console.error(error);
                alert("Something went wrong.");
                button.disabled = false;
                button.innerHTML = originalBtnHTML;
            });
    }
</script>


<style>
    .error {
        background-color: #d50000;
        color: white;
    }
    #loading-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.8);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }
    #loading-message {
        font-size: 18px;
    }
</style>
</body>
</html>
